
> svelte2tsx@0.7.35 test-current /home/user/Documents/repos/ltools-backup/packages/svelte2tsx
> mocha test/test.ts --grep "#current"



  1 - civet: generating source map raw lines #happy #current

--- Civet Code Test (Dedented) ---
Compiled TypeScript:
 let value = $state(1)
const props = (ab: number, b: number) => {
	return value = ab * b
}

const propsProbl = (ab: number, bc: number) => {
	return value = ab * bc
}

const props2 = (ab: number, bc: number) => {
	value = ab * bc;
}
Output Map: {
  "lines": [
    [
      [
        0,
        0,
        0,
        5
      ],
      [
        4,
        0,
        0,
        0
      ],
      [
        5,
        0,
        0,
        5
      ],
      [
        1,
        0,
        0,
        6
      ],
      [
        1,
        0,
        0,
        8
      ],
      [
        1,
        0,
        0,
        9
      ],
      [
        6,
        0,
        0,
        15
      ],
      [
        1,
        0,
        0,
        16
      ],
      [
        1,
        0,
        0,
        17
      ],
      [
        1,
        0,
        0,
        18
      ]
    ],
    [
      [
        0,
        0,
        1,
        0
      ],
      [
        0,
        0,
        1,
        0
      ],
      [
        0,
        0,
        1,
        5
      ],
      [
        6,
        0,
        1,
        0
      ],
      [
        5,
        0,
        1,
        5
      ],
      [
        1,
        0,
        1,
        6
      ],
      [
        1,
        0,
        1,
        8
      ],
      [
        1,
        0,
        1,
        9
      ],
      [
        1,
        0,
        1,
        10
      ],
      [
        2,
        0,
        1,
        12
      ],
      [
        1,
        0,
        1,
        13
      ],
      [
        1,
        0,
        1,
        14
      ],
      [
        6,
        0,
        1,
        20
      ],
      [
        1,
        0,
        1,
        21
      ],
      [
        1,
        0,
        1,
        22
      ],
      [
        1,
        0,
        1,
        23
      ],
      [
        1,
        0,
        1,
        24
      ],
      [
        1,
        0,
        1,
        25
      ],
      [
        6,
        0,
        1,
        31
      ],
      [
        1,
        0,
        1,
        32
      ],
      [
        1,
        0,
        1,
        33
      ],
      [
        2,
        0,
        1,
        35
      ],
      [
        1,
        0,
        1,
        35
      ],
      [
        1,
        0,
        1,
        35
      ]
    ],
    [
      [
        0,
        0,
        2,
        0
      ],
      [
        0,
        0,
        2,
        0
      ],
      [
        1
      ],
      [
        7,
        0,
        2,
        1
      ],
      [
        5,
        0,
        2,
        6
      ],
      [
        1
      ],
      [
        1,
        0,
        2,
        8
      ],
      [
        1,
        0,
        2,
        9
      ],
      [
        2,
        0,
        2,
        11
      ],
      [
        1,
        0,
        2,
        12
      ],
      [
        1,
        0,
        2,
        13
      ],
      [
        1,
        0,
        2,
        14
      ],
      [
        1
      ]
    ],
    [
      [
        0,
        0,
        2,
        15
      ],
      [
        1,
        0,
        2,
        15
      ]
    ],
    [
      [
        0,
        0,
        3,
        0
      ],
      [
        0,
        0,
        3,
        0
      ]
    ],
    [
      [
        0,
        0,
        4,
        0
      ],
      [
        0,
        0,
        4,
        0
      ],
      [
        0,
        0,
        4,
        10
      ],
      [
        6,
        0,
        4,
        0
      ],
      [
        10,
        0,
        4,
        10
      ],
      [
        1,
        0,
        4,
        11
      ],
      [
        1,
        0,
        4,
        13
      ],
      [
        1,
        0,
        4,
        14
      ],
      [
        1,
        0,
        4,
        15
      ],
      [
        2,
        0,
        4,
        17
      ],
      [
        1,
        0,
        4,
        18
      ],
      [
        1,
        0,
        4,
        19
      ],
      [
        6,
        0,
        4,
        25
      ],
      [
        1,
        0,
        4,
        26
      ],
      [
        1,
        0,
        4,
        27
      ],
      [
        2,
        0,
        4,
        29
      ],
      [
        1,
        0,
        4,
        30
      ],
      [
        1,
        0,
        4,
        31
      ],
      [
        6,
        0,
        4,
        37
      ],
      [
        1,
        0,
        4,
        38
      ],
      [
        1,
        0,
        4,
        39
      ],
      [
        2,
        0,
        4,
        41
      ],
      [
        1,
        0,
        4,
        41
      ],
      [
        1,
        0,
        4,
        41
      ]
    ],
    [
      [
        0,
        0,
        5,
        0
      ],
      [
        0,
        0,
        5,
        0
      ],
      [
        1
      ],
      [
        7,
        0,
        5,
        1
      ],
      [
        5,
        0,
        5,
        6
      ],
      [
        1
      ],
      [
        1,
        0,
        5,
        8
      ],
      [
        1,
        0,
        5,
        9
      ],
      [
        2,
        0,
        5,
        11
      ],
      [
        1,
        0,
        5,
        12
      ],
      [
        1,
        0,
        5,
        13
      ],
      [
        1,
        0,
        5,
        14
      ],
      [
        2
      ]
    ],
    [
      [
        0,
        0,
        5,
        16
      ],
      [
        1,
        0,
        5,
        16
      ]
    ],
    [
      [
        0,
        0,
        6,
        0
      ],
      [
        0,
        0,
        6,
        0
      ]
    ],
    [
      [
        0,
        0,
        7,
        0
      ],
      [
        0,
        0,
        7,
        0
      ],
      [
        0,
        0,
        7,
        6
      ],
      [
        6,
        0,
        7,
        0
      ],
      [
        6,
        0,
        7,
        6
      ],
      [
        1,
        0,
        7,
        7
      ],
      [
        1,
        0,
        7,
        9
      ],
      [
        1,
        0,
        7,
        10
      ],
      [
        1,
        0,
        7,
        11
      ],
      [
        2,
        0,
        7,
        13
      ],
      [
        1,
        0,
        7,
        14
      ],
      [
        1,
        0,
        7,
        15
      ],
      [
        6,
        0,
        7,
        21
      ],
      [
        1,
        0,
        7,
        22
      ],
      [
        1,
        0,
        7,
        23
      ],
      [
        2,
        0,
        7,
        25
      ],
      [
        1,
        0,
        7,
        26
      ],
      [
        1,
        0,
        7,
        27
      ],
      [
        6,
        0,
        7,
        33
      ],
      [
        1,
        0,
        7,
        34
      ],
      [
        1,
        0,
        7,
        35
      ],
      [
        2,
        0,
        7,
        37
      ],
      [
        1,
        0,
        7,
        37
      ],
      [
        1,
        0,
        7,
        37
      ]
    ],
    [
      [
        0,
        0,
        8,
        0
      ],
      [
        0,
        0,
        8,
        0
      ],
      [
        1,
        0,
        8,
        1
      ],
      [
        5,
        0,
        8,
        6
      ],
      [
        1
      ],
      [
        1,
        0,
        8,
        8
      ],
      [
        1,
        0,
        8,
        9
      ],
      [
        2,
        0,
        8,
        11
      ],
      [
        1,
        0,
        8,
        12
      ],
      [
        1,
        0,
        8,
        13
      ],
      [
        1,
        0,
        8,
        14
      ],
      [
        2,
        0,
        8,
        16
      ],
      [
        1
      ]
    ],
    [
      [
        0,
        0,
        9,
        0
      ]
    ]
  ],
  "line": 11,
  "colOffset": 1,
  "srcLine": 9,
  "srcColumn": 1,
  "srcOffset": 188,
  "srcTable": [
    19,
    55,
    71,
    72,
    114,
    131,
    132,
    170,
    187
  ],
  "source": "value .= $state(1)\nprops := (ab: number, b: number) =>\n\tvalue = ab * b\n\npropsProbl := (ab: number, bc: number) =>\n\tvalue = ab * bc\n\nprops2 := (ab: number, bc: number) =>\n\tvalue = ab * bc;"
}
[DEBUG] propsProblBodyMatch: [
  'const propsProbl = (ab: number, bc: number) => {\n\treturn value = ab * bc\n}',
  'ab: number, bc: number',
  '\n\treturn value = ab * bc\n',
  index: 91,
  input: 'let value = $state(1)\n' +
    'const props = (ab: number, b: number) => {\n' +
    '\treturn value = ab * b\n' +
    '}\n' +
    '\n' +
    'const propsProbl = (ab: number, bc: number) => {\n' +
    '\treturn value = ab * bc\n' +
    '}\n' +
    '\n' +
    'const props2 = (ab: number, bc: number) => {\n' +
    '\tvalue = ab * bc;\n' +
    '}',
  groups: undefined
]
[DEBUG] props2BodyMatch: [
  'const props2 = (ab: number, bc: number) => {\n\tvalue = ab * bc;\n}',
  'ab: number, bc: number',
  '\n\tvalue = ab * bc;\n',
  index: 167,
  input: 'let value = $state(1)\n' +
    'const props = (ab: number, b: number) => {\n' +
    '\treturn value = ab * b\n' +
    '}\n' +
    '\n' +
    'const propsProbl = (ab: number, bc: number) => {\n' +
    '\treturn value = ab * bc\n' +
    '}\n' +
    '\n' +
    'const props2 = (ab: number, bc: number) => {\n' +
    '\tvalue = ab * bc;\n' +
    '}',
  groups: undefined
]
Civet map lines per TS line:
Line 1: [0,0,0,5] [4,0,0,0] [5,0,0,5] [1,0,0,6] [1,0,0,8] [1,0,0,9] [6,0,0,15] [1,0,0,16] [1,0,0,17] [1,0,0,18]
Line 2: [0,0,1,0] [0,0,1,0] [0,0,1,5] [6,0,1,0] [5,0,1,5] [1,0,1,6] [1,0,1,8] [1,0,1,9] [1,0,1,10] [2,0,1,12] [1,0,1,13] [1,0,1,14] [6,0,1,20] [1,0,1,21] [1,0,1,22] [1,0,1,23] [1,0,1,24] [1,0,1,25] [6,0,1,31] [1,0,1,32] [1,0,1,33] [2,0,1,35] [1,0,1,35] [1,0,1,35]
Line 3: [0,0,2,0] [0,0,2,0] [1] [7,0,2,1] [5,0,2,6] [1] [1,0,2,8] [1,0,2,9] [2,0,2,11] [1,0,2,12] [1,0,2,13] [1,0,2,14] [1]
Line 4: [0,0,2,15] [1,0,2,15]
Line 5: [0,0,3,0] [0,0,3,0]
Line 6: [0,0,4,0] [0,0,4,0] [0,0,4,10] [6,0,4,0] [10,0,4,10] [1,0,4,11] [1,0,4,13] [1,0,4,14] [1,0,4,15] [2,0,4,17] [1,0,4,18] [1,0,4,19] [6,0,4,25] [1,0,4,26] [1,0,4,27] [2,0,4,29] [1,0,4,30] [1,0,4,31] [6,0,4,37] [1,0,4,38] [1,0,4,39] [2,0,4,41] [1,0,4,41] [1,0,4,41]
Line 7: [0,0,5,0] [0,0,5,0] [1] [7,0,5,1] [5,0,5,6] [1] [1,0,5,8] [1,0,5,9] [2,0,5,11] [1,0,5,12] [1,0,5,13] [1,0,5,14] [2]
Line 8: [0,0,5,16] [1,0,5,16]
Line 9: [0,0,6,0] [0,0,6,0]
Line 10: [0,0,7,0] [0,0,7,0] [0,0,7,6] [6,0,7,0] [6,0,7,6] [1,0,7,7] [1,0,7,9] [1,0,7,10] [1,0,7,11] [2,0,7,13] [1,0,7,14] [1,0,7,15] [6,0,7,21] [1,0,7,22] [1,0,7,23] [2,0,7,25] [1,0,7,26] [1,0,7,27] [6,0,7,33] [1,0,7,34] [1,0,7,35] [2,0,7,37] [1,0,7,37] [1,0,7,37]
Line 11: [0,0,8,0] [0,0,8,0] [1,0,8,1] [5,0,8,6] [1] [1,0,8,8] [1,0,8,9] [2,0,8,11] [1,0,8,12] [1,0,8,13] [1,0,8,14] [2,0,8,16] [1]
Line 12: [0,0,9,0]
    ✔ handles state and propFunc declarations (dedented) (375ms)

  2 - normalizeCivetMap = converting lines to v3 (dynamic scenarios) #happy #current

--- Scenario: dedented state and propFunc declarations ---

Civet Input:
 value .= $state(1)
props := (ab: number, b: number) =>
	value = ab * b

propsProbl := (ab: number, bc: number) =>
	value = ab * bc

props2 := (ab: number, bc: number) =>
	value = ab * bc;
TypeScript Output:
 let value = $state(1)
const props = (ab: number, b: number) => {
	return value = ab * b
}

const propsProbl = (ab: number, bc: number) => {
	return value = ab * bc
}

const props2 = (ab: number, bc: number) => {
	value = ab * bc;
}
[MAP_TO_V3 test.svelte] Normalizing Civet map. Snippet line offset in Svelte (0-based): 1
[MAP_TO_V3 test.svelte] Final Normalized Civet-Svelte map (first 3 lines of mappings): AACK,IAAL,KAAK,CAAC,CAAE,CAAC,MAAM,CAAC,CAAC,CAAC;AAClB,AAAA,AAAK,MAAL,KAAK,CAAC,CAAE,CAAC,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAA,CAAA;AACnC,AAAA,QAAC,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC
Decoded V3 mapping segments per TS line:
Line 1: [0,0,1,5] [4,0,1,0] [9,0,1,5] [10,0,1,6] [11,0,1,8] [12,0,1,9] [18,0,1,15] [19,0,1,16] [20,0,1,17] [21,0,1,18]
Line 2: [0,0,2,0] [0,0,2,0] [0,0,2,5] [6,0,2,0] [11,0,2,5] [12,0,2,6] [13,0,2,8] [14,0,2,9] [15,0,2,10] [17,0,2,12] [18,0,2,13] [19,0,2,14] [25,0,2,20] [26,0,2,21] [27,0,2,22] [28,0,2,23] [29,0,2,24] [30,0,2,25] [36,0,2,31] [37,0,2,32] [38,0,2,33] [40,0,2,35] [41,0,2,35] [42,0,2,35]
Line 3: [0,0,3,0] [0,0,3,0] [8,0,3,1] [13,0,3,6] [15,0,3,8] [16,0,3,9] [18,0,3,11] [19,0,3,12] [20,0,3,13] [21,0,3,14]
Line 4: [0,0,3,15] [1,0,3,15]
Line 5: [0,0,4,0] [0,0,4,0]
Line 6: [0,0,5,0] [0,0,5,0] [0,0,5,10] [6,0,5,0] [16,0,5,10] [17,0,5,11] [18,0,5,13] [19,0,5,14] [20,0,5,15] [22,0,5,17] [23,0,5,18] [24,0,5,19] [30,0,5,25] [31,0,5,26] [32,0,5,27] [34,0,5,29] [35,0,5,30] [36,0,5,31] [42,0,5,37] [43,0,5,38] [44,0,5,39] [46,0,5,41] [47,0,5,41] [48,0,5,41]
Line 7: [0,0,6,0] [0,0,6,0] [8,0,6,1] [13,0,6,6] [15,0,6,8] [16,0,6,9] [18,0,6,11] [19,0,6,12] [20,0,6,13] [21,0,6,14]
Line 8: [0,0,6,16] [1,0,6,16]
Line 9: [0,0,7,0] [0,0,7,0]
Line 10: [0,0,8,0] [0,0,8,0] [0,0,8,6] [6,0,8,0] [12,0,8,6] [13,0,8,7] [14,0,8,9] [15,0,8,10] [16,0,8,11] [18,0,8,13] [19,0,8,14] [20,0,8,15] [26,0,8,21] [27,0,8,22] [28,0,8,23] [30,0,8,25] [31,0,8,26] [32,0,8,27] [38,0,8,33] [39,0,8,34] [40,0,8,35] [42,0,8,37] [43,0,8,37] [44,0,8,37]
Line 11: [0,0,9,0] [0,0,9,0] [1,0,9,1] [6,0,9,6] [8,0,9,8] [9,0,9,9] [11,0,9,11] [12,0,9,12] [13,0,9,13] [14,0,9,14] [16,0,9,16]
Line 12: [0,0,10,0]
    ✔ should map tokens for dedented state and propFunc declarations (358ms)


  2 passing (771ms)

