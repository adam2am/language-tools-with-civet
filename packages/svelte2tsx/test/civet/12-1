
> svelte2tsx@0.7.35 test-current /home/user/Documents/repos/ltools-backup/packages/svelte2tsx
> mocha test/test.ts --grep "#current"



  2.1 - Preprocessor loop mapping differences #current

--- Scenario: Mapping for multi-character variables at the end of a line vs. followed by other tokens (1EndOfTheLine.svelte) ---
[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Initializing for /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte
[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Found <script lang="civet"> (instance) at content start 21, end 112
[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Original snippet from Svelte (21-112):

	va .= $state(1)
	varNice := () =>
		number .= va + 0

	varIssue := () =>
		number .= va


[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Dedent Info: removedIndentString="" (length: 0)
[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Dedented snippet (removed 0 chars of indent):
	va .= $state(1)
	varNice := () =>
		number .= va + 0

	varIssue := () =>
		number .= va


[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Civet compiled to TS:
	let va = $state(1)
	const varNice = () => {
		let number = va + 0;return number
	}

	const varIssue = () => {
		let number = va;return number
	}


[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Raw Civet-to-TS map (first 3 lines of mappings): [[[0,0,0,0],[1,0,0,3],[4,0,0,1],[2,0,0,3],[1,0,0,4],[1,0,0,6],[1,0,0,7],[6,0,0,13],[1,0,0,14],[1,0,0,15],[1,0,0,16]],[[0,0,1,0],[0,0,1,0],[1,0,1,8],[6,0,1,1],[7,0,1,8],[1,0,1,9],[1,0,1,11],[1,0,1,12],[1,0,1,13],[1,0,1,14],[1,0,1,15],[2,0,1,17],[1,0,1,17],[1,0,1,17]],[[0,0,2,0],[0,0,2,0],[2,0,2,8],[4,0,2,2],[6,0,2,8],[1,0,2,9],[1,0,2,11],[1,0,2,12],[2,0,2,14],[1,0,2,15],[1,0,2,16],[1,0,2,17],[1],[1],[6],[1,0,2,2],[6]]]
[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Original content start in Svelte: line 2 (0-based offset: 1)
[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Normalizing Civet map. originalContentStartLine: 2, removedIndentLength: 0, filename: /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte
[MAP_TO_V3 /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Normalizing Civet map. Snippet line offset in Svelte (0-based): 1
[MAP_TO_V3 /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Final Normalized Civet-Svelte map (first 3 lines of mappings): AACA,CAAG,IAAF,EAAE,CAAC,CAAE,CAAC,MAAM,CAAC,CAAC,CAAC;AAChB,CAAQ,MAAP,OAAO,CAAC,CAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA,CAAA;AACjB,EAAQ,IAAN,MAAM,CAAC,CAAE,CAAC,EAAE,CAAC,CAAC,CAAC,SAAf
[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Normalized Civet-Svelte map (first 3 lines of mappings): AACA,CAAG,IAAF,EAAE,CAAC,CAAE,CAAC,MAAM,CAAC,CAAC,CAAC;AAChB,CAAQ,MAAP,OAAO,CAAC,CAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA,CAAA;AACjB,EAAQ,IAAN,MAAM,CAAC,CAAE,CAAC,EAAE,CAAC,CAAC,CAAC,SAAf
[PREPROC_CIVET /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte] Reindented compiled TS code for insertion (indent: ""):

	let va = $state(1)
	const varNice = () => {
		let number = va + 0;return number
	}

	const varIssue = () => {
		let number = va;return number
	}

Original Svelte Content:
 <script lang="civet">
	va .= $state(1)
	varNice := () =>
		number .= va + 0

	varIssue := () =>
		number .= va

</script>
<div>{fruits}</div> 
Compiled TS Code (from preprocessor):
 	let va = $state(1)
	const varNice = () => {
		let number = va + 0;return number
	}

	const varIssue = () => {
		let number = va;return number
	}

Info from CivetBlockInfo:
  originalContentStartLine_1based: 2
  originalCivetLineCount: 9
  compiledTsLineCount: 10
Raw Civet-to-TS map lines:
  line 1 : [0,0,0,0][1,0,0,3][4,0,0,1][2,0,0,3][1,0,0,4][1,0,0,6][1,0,0,7][6,0,0,13][1,0,0,14][1,0,0,15][1,0,0,16]
  line 2 : [0,0,1,0][0,0,1,0][1,0,1,8][6,0,1,1][7,0,1,8][1,0,1,9][1,0,1,11][1,0,1,12][1,0,1,13][1,0,1,14][1,0,1,15][2,0,1,17][1,0,1,17][1,0,1,17]
  line 3 : [0,0,2,0][0,0,2,0][2,0,2,8][4,0,2,2][6,0,2,8][1,0,2,9][1,0,2,11][1,0,2,12][2,0,2,14][1,0,2,15][1,0,2,16][1,0,2,17][1][1][6][1,0,2,2][6]
  line 4 : [1,0,2,18][1,0,2,18]
  line 5 : [0,0,3,0][0,0,3,0]
  line 6 : [0,0,4,0][0,0,4,0][1,0,4,9][6,0,4,1][8,0,4,9][1,0,4,10][1,0,4,12][1,0,4,13][1,0,4,14][1,0,4,15][1,0,4,16][2,0,4,18][1,0,4,18][1,0,4,18]
  line 7 : [0,0,5,0][0,0,5,0][2,0,5,8][4,0,5,2][6,0,5,8][1,0,5,9][1,0,5,11][1,0,5,12][2][1][6][1,0,5,2][6]
  line 8 : [1,0,5,14][1,0,5,14]
  line 9 : [0,0,6,0]
  line 10 : [0,0,7,0]
Normalized V3 map from Preprocessor:
  Line 1: AACA,CAAG,IAAF,EAAE,CAAC,CAAE,CAAC,MAAM,CAAC,CAAC,CAAC
  Line 2: AAChB,CAAQ,MAAP,OAAO,CAAC,CAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA,CAAA
  Line 3: AACjB,EAAQ,IAAN,MAAM,CAAC,CAAE,CAAC,EAAE,CAAC,CAAC,CAAC,SAAf
  Line 4: CAAgB,CAAA
  Line 5: AAClB
  Line 6: AACA,CAAS,MAAR,QAAQ,CAAC,CAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA,CAAA
  Line 7: AAClB,EAAQ,IAAN,MAAM,CAAC,CAAE,CAAC,UAAV
  Line 8: CAAY,CAAA
  Line 9: AACd
  Line 10: AACA
Decoded V3 mapping segments:
  TS Line 1: [0,0,1,0] [1,0,1,3] [5,0,1,1] [7,0,1,3] [8,0,1,4] [9,0,1,6] [10,0,1,7] [16,0,1,13] [17,0,1,14] [18,0,1,15] [19,0,1,16]
  TS Line 2: [0,0,2,0] [1,0,2,8] [7,0,2,1] [14,0,2,8] [15,0,2,9] [16,0,2,11] [17,0,2,12] [18,0,2,13] [19,0,2,14] [20,0,2,15] [22,0,2,17] [23,0,2,17] [24,0,2,17]
  TS Line 3: [0,0,3,0] [2,0,3,8] [6,0,3,2] [12,0,3,8] [13,0,3,9] [14,0,3,11] [15,0,3,12] [17,0,3,14] [18,0,3,15] [19,0,3,16] [20,0,3,17] [29,0,3,2]
  TS Line 4: [1,0,3,18] [2,0,3,18]
  TS Line 5: [0,0,4,0]
  TS Line 6: [0,0,5,0] [1,0,5,9] [7,0,5,1] [15,0,5,9] [16,0,5,10] [17,0,5,12] [18,0,5,13] [19,0,5,14] [20,0,5,15] [21,0,5,16] [23,0,5,18] [24,0,5,18] [25,0,5,18]
  TS Line 7: [0,0,6,0] [2,0,6,8] [6,0,6,2] [12,0,6,8] [13,0,6,9] [14,0,6,11] [15,0,6,12] [25,0,6,2]
  TS Line 8: [1,0,6,14] [2,0,6,14]
  TS Line 9: [0,0,7,0]
  TS Line 10: [0,0,8,0]
  Token 'va_decl': Found TS ('va') at 1:5. Mapped to Original: {"source":"/home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/fixtures/1EndOfTheLine.svelte","line":2,"column":1,"name":null}
    1) should correctly map tokens for Mapping for multi-character variables at the end of a line vs. followed by other tokens


  0 passing (173ms)
  1 failing

  1) 2.1 - Preprocessor loop mapping differences #current
       should correctly map tokens for Mapping for multi-character variables at the end of a line vs. followed by other tokens:

      AssertionError [ERR_ASSERTION]: Original column mismatch for token 'va_decl'. Expected 0 (0-indexed), got 1. TS Line: 1, Col: 5
      + expected - actual

      -1
      +0
      
      at /home/user/Documents/repos/ltools-backup/packages/svelte2tsx/test/civet/2.1 - current - loopsPreprocessor.test.ts:178:16
      at Generator.next (<anonymous>)
      at fulfilled (test/civet/2.1 - current - loopsPreprocessor.test.ts:38:58)



/home/user/Documents/repos/ltools-backup/packages/svelte2tsx:
 ERR_PNPM_RECURSIVE_RUN_FIRST_FAIL  svelte2tsx@0.7.35 test-current: `mocha test/test.ts --grep "#current"`
Exit status 1
