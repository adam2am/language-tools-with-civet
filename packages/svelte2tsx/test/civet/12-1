
> svelte2tsx@0.7.35 test-current /home/user/Documents/repos/ltools-backup/packages/svelte2tsx
> mocha test/test.ts --grep "#current"



  1 - civet: generating source map raw lines #happy #current

--- Civet Code Test (Dedented) ---
Compiled TypeScript:
 // Loop example
let i = 0;for (const fruit of fruits) {const index = i++;
  console.log(`Fruit ${index + 1}: ${fruit}`)
}

for (const fruit in fruits) {const index = fruits[fruit];
  console.log(`Fruit ${index + 1}: ${fruit}`)
}
Civet raw lines per TS line:
Line 1: [0,0,0,0] [15,0,0,15]
Line 2: [0,0,1,0] [4] [1] [4] [1,0,1,0] [3,0,1,3] [1,0,1,4] [1,0,1,4] [6,0,1,4] [5,0,1,16] [1,0,1,17] [2,0,1,19] [1,0,1,20] [6,0,1,26] [1,0,1,26] [1,0,1,26] [1,0,1,10] [0,0,1,11] [6,0,1,11] [5] [3] [1] [2] [1,0,1,26]
Line 3: [0,0,2,0] [0,0,2,0] [2,0,2,2] [7,0,2,9] [1,0,2,10] [3,0,2,13] [1,0,2,13] [0,0,2,14] [1,0,2,15] [6,0,2,21] [2,0,2,23] [5,0,2,28] [1,0,2,29] [1,0,2,30] [1,0,2,31] [1,0,2,32] [1,0,2,33] [2,0,2,35] [2,0,2,37] [5,0,2,42] [1,0,2,43] [1,0,2,44] [1]
Line 4: [0,0,2,44] [1,0,2,44]
Line 5: [0,0,3,0] [0,0,3,0]
Line 6: [0,0,4,0] [0,0,4,0] [0,0,4,0] [3,0,4,3] [1,0,4,4] [1,0,4,4] [6,0,4,4] [5,0,4,16] [1,0,4,17] [2,0,4,19] [1,0,4,20] [6,0,4,26] [1,0,4,26] [1,0,4,26] [1,0,4,10] [0,0,4,11] [6,0,4,11] [5] [3,0,4,19] [0,0,4,20] [6] [1,0,4,4] [5] [1] [1,0,4,26]
Line 7: [0,0,5,0] [0,0,5,0] [2,0,5,2] [7,0,5,9] [1,0,5,10] [3,0,5,13] [1,0,5,13] [0,0,5,14] [1,0,5,15] [6,0,5,21] [2,0,5,23] [5,0,5,28] [1,0,5,29] [1,0,5,30] [1,0,5,31] [1,0,5,32] [1,0,5,33] [2,0,5,35] [2,0,5,37] [5,0,5,42] [1,0,5,43] [1,0,6,0] [1]
Line 8: [0,0,6,0]
    1) handles state and propFunc declarations (dedented)

  2 - normalizeCivetMap = converting lines to v3 (dynamic scenarios) #happy #current

--- Scenario: for loops (of vs in) ---

Civet Input:
 // Loop example
for fruit, index of fruits
  console.log `Fruit ${index + 1}: ${fruit}`

for fruit, index in fruits
  console.log `Fruit ${index + 1}: ${fruit}`
TypeScript Output:
 // Loop example
let i = 0;for (const fruit of fruits) {const index = i++;
  console.log(`Fruit ${index + 1}: ${fruit}`)
}

for (const fruit in fruits) {const index = fruits[fruit];
  console.log(`Fruit ${index + 1}: ${fruit}`)
}
[MAP_TO_V3 test.svelte] Normalizing Civet map. Snippet line offset in Svelte (0-based): 1
[MAP_TO_V3 test.svelte] Final Normalized Civet-Svelte map (first 3 lines of mappings): AACA,eAAe;AACf,UAAA,GAAG,CAAC,CAAA,MAAA,KAAY,CAAC,EAAE,CAAC,MAAM,CAAA,CAAA,CAAhB,AAAC,MAAA,YAAe;AAC1B,AAAA,EAAE,OAAO,CAAC,GAAG,CAAA,AAAC,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC
Decoded V3 mapping segments per TS line:
Line 1: [0,0,1,0] [15,0,1,15]
Line 2: [0,0,2,0] [10,0,2,0] [13,0,2,3] [14,0,2,4] [15,0,2,4] [21,0,2,4] [26,0,2,16] [27,0,2,17] [29,0,2,19] [30,0,2,20] [36,0,2,26] [37,0,2,26] [38,0,2,26] [39,0,2,10] [39,0,2,11] [45,0,2,11] [57,0,2,26]
Line 3: [0,0,3,0] [0,0,3,0] [2,0,3,2] [9,0,3,9] [10,0,3,10] [13,0,3,13] [14,0,3,13] [14,0,3,14] [15,0,3,15] [21,0,3,21] [23,0,3,23] [28,0,3,28] [29,0,3,29] [30,0,3,30] [31,0,3,31] [32,0,3,32] [33,0,3,33] [35,0,3,35] [37,0,3,37] [42,0,3,42] [43,0,3,43] [44,0,3,44]
Line 4: [0,0,3,44] [1,0,3,44]
Line 5: [0,0,4,0] [0,0,4,0]
Line 6: [0,0,5,0] [0,0,5,0] [0,0,5,0] [3,0,5,3] [4,0,5,4] [5,0,5,4] [11,0,5,4] [16,0,5,16] [17,0,5,17] [19,0,5,19] [20,0,5,20] [26,0,5,26] [27,0,5,26] [28,0,5,26] [29,0,5,10] [29,0,5,11] [35,0,5,11] [43,0,5,19] [43,0,5,20] [50,0,5,4] [57,0,5,26]
Line 7: [0,0,6,0] [0,0,6,0] [2,0,6,2] [9,0,6,9] [10,0,6,10] [13,0,6,13] [14,0,6,13] [14,0,6,14] [15,0,6,15] [21,0,6,21] [23,0,6,23] [28,0,6,28] [29,0,6,29] [30,0,6,30] [31,0,6,31] [32,0,6,32] [33,0,6,33] [35,0,6,35] [37,0,6,37] [42,0,6,42] [43,0,6,43] [44,0,7,0]
Line 8: [0,0,7,0]
    ✔ should map tokens for for loops (of vs in) (45ms)


  1 passing (236ms)
  1 failing

  1) 1 - civet: generating source map raw lines #happy #current
       handles state and propFunc declarations (dedented):

      AssertionError [ERR_ASSERTION]: Expected two console.log calls with template literals
      + expected - actual

      -false
      +true
      
      at Context.<anonymous> (test/civet/1 - current - mapRawLines.test.ts:30:12)
      at processImmediate (node:internal/timers:476:21)



/home/user/Documents/repos/ltools-backup/packages/svelte2tsx:
 ERR_PNPM_RECURSIVE_RUN_FIRST_FAIL  svelte2tsx@0.7.35 test-current: `mocha test/test.ts --grep "#current"`
Exit status 1
